<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Processing - RekApp</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="processing-page-container">
        <div class="processing-card-container">
            <div class="processing-header-container">
                <h1>
                    {% if job_type == 'text' %}
                        <i class="fas fa-file-alt"></i> Processing Text
                    {% else %}
                        <i class="fas fa-cogs"></i> Processing Your Video
                    {% endif %}
                </h1>
                <p class="job-id-display">Job ID: {{ job_id }}</p>
            </div>
            
            <div class="processing-steps-container">
                {% if job_type == 'text' %}
                    <div class="processing-step active" id="step1">
                        <div class="processing-step-icon"><i class="fas fa-align-left"></i></div>
                        <div class="processing-step-content">
                            <h4 class="processing-step-content-title">1. Analyzing Text</h4>
                            <p class="processing-step-content-description">Reading content...</p>
                        </div>
                    </div>
                    <div class="processing-step" id="step2">
                        <div class="processing-step-icon"><i class="fas fa-brain"></i></div>
                        <div class="processing-step-content">
                            <h4 class="processing-step-content-title">2. AI Summarization</h4>
                            <p class="processing-step-content-description">Generating concise summary...</p>
                        </div>
                    </div>
                    <div class="processing-step" id="step3">
                        <div class="processing-step-icon"><i class="fas fa-check-circle"></i></div>
                        <div class="processing-step-content">
                            <h4 class="processing-step-content-title">3. Finalizing</h4>
                            <p class="processing-step-content-description">Preparing results...</p>
                        </div>
                    </div>
                {% else %}
                    <div class="processing-step active" id="step1">
                        <div class="processing-step-icon"><i class="fas fa-file-video"></i></div>
                        <div class="processing-step-content">
                            <h4 class="processing-step-content-title">1. Loading Video</h4>
                            <p class="processing-step-content-description">Reading your video file...</p>
                        </div>
                    </div>
                    <div class="processing-step" id="step2">
                        <div class="processing-step-icon"><i class="fas fa-volume-up"></i></div>
                        <div class="processing-step-content">
                            <h4 class="processing-step-content-title">2. Extracting Audio</h4>
                            <p class="processing-step-content-description">Converting video to audio...</p>
                        </div>
                    </div>
                    <div class="processing-step" id="step3">
                        <div class="processing-step-icon"><i class="fas fa-comment-dots"></i></div>
                        <div class="processing-step-content">
                            <h4 class="processing-step-content-title">3. Speech to Text</h4>
                            <p class="processing-step-content-description">Transcribing audio content...</p>
                        </div>
                    </div>
                    <div class="processing-step" id="step4">
                        <div class="processing-step-icon"><i class="fas fa-robot"></i></div>
                        <div class="processing-step-content">
                            <h4 class="processing-step-content-title">4. Generating Summary</h4>
                            <p class="processing-step-content-description">AI is creating your summary...</p>
                        </div>
                    </div>
                {% endif %}
            </div>
            
            <div class="progress-container">
                <div class="progress-bar-container">
                    <div class="progress-bar-fill" id="progressFill"></div>
                </div>
                <div class="progress-text-display" id="progressText">0%</div>
            </div>
            
            <div class="processing-message-container" id="processingMessage">
                <i class="fas fa-sync fa-spin"></i>
                <span>Please wait...</span>
            </div>
            
            <div class="error-message-container" id="errorMessage" style="display: none;">
                <i class="fas fa-exclamation-triangle"></i>
                <span id="errorText"></span>
            </div>
        </div>
    </div>
    
    <script>
        const jobId = "{{ job_id }}";
        const jobType = "{{ job_type }}"; // 'video' or 'text'
        
        function updateProgress(step) {
            const steps = document.querySelectorAll('.processing-step');
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            
            // Activate current step visual logic
            steps.forEach((s, index) => {
                if (index < step) {
                    s.classList.add('completed', 'active');
                } else if (index === step) {
                    s.classList.add('active');
                    s.classList.remove('completed');
                } else {
                    s.classList.remove('active', 'completed');
                }
            });
            
            const progress = ((step + 1) / steps.length) * 100;
            progressFill.style.width = `${progress}%`;
            progressText.textContent = `${Math.round(progress)}%`;
        }
        
        function checkStatus() {
            fetch(`/status/${jobId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'complete') {
                        updateProgress(10); 
                        setTimeout(() => window.location.href = data.redirect, 500);
                    } else if (data.status === 'error') {
                        document.getElementById('errorText').textContent = data.message;
                        document.getElementById('errorMessage').style.display = 'flex';
                        document.getElementById('processingMessage').style.display = 'none';
                    } else {
                        setTimeout(checkStatus, 2000);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    setTimeout(checkStatus, 3000);
                });
        }
        
        let currentStep = 0;
        const totalSteps = document.querySelectorAll('.processing-step').length;
        
        const intervalTime = jobType === 'text' ? 1000 : 3000; 

        function simulateProgress() {
            if (currentStep < totalSteps - 1) {
                updateProgress(currentStep);
                currentStep++;
                setTimeout(simulateProgress, intervalTime);
            }
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            simulateProgress();
            checkStatus();
        });
    </script>
</body>
</html>